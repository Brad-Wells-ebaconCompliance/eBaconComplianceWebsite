<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trust Savings Calculator</title>

  <style>
    :root{
      --bg:#2f3642; --panel:rgba(201,215,216,.92);
      --ink:#1f2937; --muted:#475569;
      --field:#3f4654; --fieldText:#fff;
      --accent:#17a2a0; --accent2:#12b3b1;
      --danger:#ef4444; --ok:#22c55e;
      --shadow:0 30px 70px rgba(0,0,0,.38);
      --radius:24px; --radius2:16px;
      --ring:0 0 0 3px rgba(23,162,160,.25);
      --font:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:var(--font); color:var(--ink); overflow-x:hidden;
      background:
        radial-gradient(1100px 800px at 15% 10%, rgba(23,162,160,.28), transparent 60%),
        radial-gradient(1000px 700px at 90% 20%, rgba(255,255,255,.08), transparent 55%),
        linear-gradient(180deg, #232a34 0%, var(--bg) 100%);
    }
    .grain{position:fixed; inset:0; pointer-events:none; opacity:.07; mix-blend-mode:overlay;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
    }
    .wrap{min-height:100%; display:flex; align-items:center; justify-content:center; padding:56px 16px;}
    .card{
      width:min(960px,100%); background:var(--panel); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:34px; position:relative; overflow:hidden;
      border:1px solid rgba(255,255,255,.35); backdrop-filter: blur(10px);
    }
    .card:before{content:""; position:absolute; inset:-2px; pointer-events:none; opacity:.65;
      background:
        radial-gradient(700px 300px at 20% 0%, rgba(23,162,160,.35), transparent 55%),
        radial-gradient(700px 350px at 90% 10%, rgba(255,255,255,.22), transparent 55%);
    }
    .inner{position:relative; z-index:1;}
    .top{display:flex; justify-content:space-between; gap:18px; margin-bottom:18px; flex-wrap:wrap;}
    h1{margin:0; font-size:30px;}
    .sub{margin:8px 0 0; color:var(--muted); font-size:14px; line-height:1.4;}
    .badge{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:999px;
      background:rgba(23,162,160,.12); border:1px solid rgba(23,162,160,.25); color:#0f766e;
      font-weight:700; font-size:13px;
    }
    .dot{width:10px; height:10px; border-radius:999px; background:var(--accent);
      box-shadow:0 0 0 4px rgba(23,162,160,.18);
    }
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:18px;}
    @media(max-width:860px){.grid{grid-template-columns:1fr}.card{padding:22px}}
    label{display:block; font-weight:800; margin:0 0 8px; color:#1e293b; font-size:13px;}
    .req:after{content:" *"; color:var(--danger);}
    .field{
      width:100%; height:52px; border-radius:var(--radius2);
      border:1px solid rgba(255,255,255,.35); background:var(--field);
      color:var(--fieldText); padding:14px 16px; font-size:15px; outline:none;
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    .field:focus{box-shadow:var(--ring); border-color:rgba(23,162,160,.45);}
    .field::placeholder{color:rgba(255,255,255,.6)}
    select.field{background:#fff; color:#0b1220; border:1px solid rgba(15,23,42,.12);}
    .hint{margin-top:8px; font-size:12px; color:rgba(30,41,59,.75);}
    .actions{display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:18px;}
    .btn{
      height:54px; border-radius:var(--radius2); border:none; cursor:pointer;
      font-weight:850; padding:0 18px; display:inline-flex; gap:10px; align-items:center;
      transition: transform .08s ease, filter .15s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btnPrimary{
      background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#fff; min-width:260px;
      box-shadow:0 16px 30px rgba(23,162,160,.22);
    }
    .btnPrimary:hover{filter:brightness(1.03)}
    .btnGhost{background:rgba(255,255,255,.55); color:#0b1220; border:1px solid rgba(15,23,42,.12);}
    .btn[disabled]{opacity:.55; cursor:not-allowed;}
    .total{
      margin-top:18px; padding:18px; border-radius:18px; background:rgba(231,236,236,.85);
      border:1px solid rgba(15,23,42,.08); display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .total .label{color:rgba(30,41,59,.85); font-weight:750;}
    .total .val{font-size:30px; font-weight:900; color:var(--accent);}
    .statusRow{margin-top:12px; display:flex; gap:10px; align-items:center; font-size:13px; min-height:18px;}
    .spinner{width:14px; height:14px; border-radius:999px; border:2px solid rgba(30,41,59,.25);
      border-top-color:rgba(23,162,160,.95); animation:spin .9s linear infinite; display:none;}
    .spinner.on{display:inline-block}
    @keyframes spin{to{transform:rotate(360deg)}}
    .toast{
      position:fixed; bottom:18px; left:50%; transform:translateX(-50%);
      background:rgba(15,23,42,.92); color:#fff; border:1px solid rgba(255,255,255,.14);
      border-radius:999px; padding:10px 14px; box-shadow:0 18px 40px rgba(0,0,0,.35);
      display:none; gap:10px; align-items:center; font-size:13px; z-index:50; max-width:calc(100% - 24px);
    }
    .toast.show{display:flex}
    .toast .pill{width:10px; height:10px; border-radius:999px; background:var(--ok);
      box-shadow:0 0 0 4px rgba(34,197,94,.2);}
    .toast.bad .pill{background:var(--danger); box-shadow:0 0 0 4px rgba(239,68,68,.2);}
    .error{border-color:rgba(239,68,68,.6)!important; box-shadow:0 0 0 3px rgba(239,68,68,.18)!important;}
  </style>
</head>

<body>
  <div class="grain"></div>

  <div class="wrap">
    <main class="card">
      <div class="inner">
        <div class="top">
          <div>
            <h1>Trust Savings Calculator</h1>
            <div class="sub">Calculate estimated annual trust savings, then submit to your Power Automate flow.</div>
          </div>
          <div class="badge"><span class="dot"></span>Flow Submit</div>
        </div>

        <section class="grid">
          <div>
            <label class="req" for="company">Company Name</label>
            <input id="company" class="field" placeholder="e.g., Acme Construction" />
          </div>

          <div>
            <label class="req" for="email">Email</label>
            <input id="email" type="email" class="field" placeholder="name@company.com" />
          </div>

          <div>
            <label class="req" for="totalCompanyEEs">Total Company Employees</label>
            <input id="totalCompanyEEs" type="number" class="field" min="0" placeholder="e.g., 120" />
          </div>

          <div>
            <label class="req" for="fieldEEs">Total Field Employees</label>
            <input id="fieldEEs" type="number" class="field" min="0" placeholder="e.g., 75" />
          </div>

          <div>
            <label class="req" for="pwFieldEEs">PW Field Employees</label>
            <input id="pwFieldEEs" type="number" class="field" min="0" placeholder="e.g., 40" />
          </div>

          <div>
            <label class="req" for="pwPercent">PW Work %</label>
            <input id="pwPercent" type="number" class="field" min="0" max="100" placeholder="e.g., 60" />
          </div>

          <div>
            <label class="req" for="benefits">Benefits Provided</label>
            <select id="benefits" class="field">
              <option value="">Select</option>
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>

          <div>
            <label class="req" for="netFringe">Average Remaining Fringe ($/Hr.)</label>
            <input id="netFringe" type="number" step="0.01" class="field" min="0" placeholder="e.g., 8.25" />
          </div>

          <div>
            <label for="wcPercent">WC Percent (leave blank for 5%)</label>
            <input id="wcPercent" type="number" class="field" min="0" max="100" placeholder="default 5" />
            <div class="hint">If blank, we use 5%.</div>
          </div>
        </section>

        <div class="actions">
          <button id="calcBtn" class="btn btnPrimary" type="button">Calculate + Submit ↗</button>
          <button id="resetBtn" class="btn btnGhost" type="button">Reset</button>
          <div class="statusRow" aria-live="polite">
            <span class="spinner" id="spinner"></span>
            <span id="statusText"></span>
          </div>
        </div>

        <div class="total">
          <div class="label">Estimated Annual Trust Savings</div>
          <div class="val" id="trustSavingsValue">$0</div>
        </div>
      </div>
    </main>
  </div>

  <div class="toast" id="toast">
    <span class="pill"></span>
    <span id="toastText">Saved!</span>
  </div>

  <script>
    (function () {
      // ⚠️ Public GitHub Pages will expose this URL (including sig) in view-source.
      const FLOW_URL =
        "https://9e44ec6cf803e40cabf4a32bc17720.03.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/2a2a236af9d741f89b24a90b9074460c/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=0QSrr9-Xy4BVcf-uJmeW8nFwHLlp65tJrHNbzPyEfIE";

      const $ = (id) => document.getElementById(id);
      const n = (v) => (Number.isFinite(Number(v)) ? Number(v) : 0);
      const int0 = (v) => (Number.isFinite(parseInt(v, 10)) ? parseInt(v, 10) : 0);

      function formatMoney(x) {
        return "$" + Math.round(x).toLocaleString("en-US");
      }

      function showToast(msg, ok = true) {
        const t = $("toast");
        $("toastText").textContent = msg;
        t.classList.toggle("bad", !ok);
        t.classList.add("show");
        clearTimeout(showToast._t);
        showToast._t = setTimeout(() => t.classList.remove("show"), 2600);
      }

      function setBusy(b, msg) {
        $("spinner").classList.toggle("on", !!b);
        $("calcBtn").disabled = !!b;
        $("resetBtn").disabled = !!b;
        $("statusText").textContent = msg || "";
      }

      function markError(el, on) { el.classList.toggle("error", !!on); }

      function validateRequired() {
        const req = ["company","email","totalCompanyEEs","fieldEEs","pwFieldEEs","pwPercent","benefits","netFringe"];
        let ok = true;

        req.forEach(id => {
          const el = $(id);
          const v = (el.value || "").trim();
          const empty = v === "";
          markError(el, empty);
          if (empty) ok = false;
        });

        const email = $("email").value.trim();
        const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        markError($("email"), !emailOk);
        if (!emailOk) ok = false;

        return ok;
      }

      $("calcBtn").addEventListener("click", async () => {
        if (!validateRequired()) {
          showToast("Please fill all required fields.", false);
          $("statusText").textContent = "Missing required fields.";
          return;
        }

        // Calculate (same logic you had)
        const pwField = n($("pwFieldEEs").value);
        const pwPct = n($("pwPercent").value) / 100;
        const fringe = n($("netFringe").value);
        const wc = ($("wcPercent").value.trim() === "") ? 0.05 : (n($("wcPercent").value) / 100);

        const savings = pwField * 2080 * pwPct * fringe * (0.0965 + wc);
        $("trustSavingsValue").textContent = formatMoney(savings);

        // Payload fields (exact names)
        const payload = {
          bw_CompanyName: $("company").value.trim(),
          bw_Email: $("email").value.trim(),
          bw_TotalCompanyEmployees: int0($("totalCompanyEEs").value),
          bw_TotalFieldEmployees: int0($("fieldEEs").value),
          bw_PWFieldEmployees: int0($("pwFieldEEs").value),
          bw_PWWorkPercent: n($("pwPercent").value),
          bw_BenefitsProvided: $("benefits").value === "true",
          bw_AverageRemainingFringe: n($("netFringe").value),
          bw_WCPercent: ($("wcPercent").value.trim() === "" ? 5 : n($("wcPercent").value)),
          bw_EstimatedAnnualSavings: savings
        };

        setBusy(true, "Submitting to Power Automate…");

        try {
          const res = await fetch(FLOW_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });

          if (!res.ok) {
            const txt = await res.text().catch(() => "");
            throw new Error(txt || ("HTTP " + res.status));
          }

          // Flow often returns 202/200 with or without JSON
          setBusy(false, "Submitted successfully.");
          showToast("Submitted successfully!", true);
          console.log("Submitted payload:", payload);

        } catch (e) {
          console.error("Flow error:", e);
          setBusy(false, "Error submitting. Check console.");
          showToast("Error submitting. Check console.", false);
        }
      });

      $("resetBtn").addEventListener("click", () => {
        ["company","email","totalCompanyEEs","fieldEEs","pwFieldEEs","pwPercent","benefits","netFringe","wcPercent"]
          .forEach(id => { $(id).value = ""; markError($(id), false); });
        $("trustSavingsValue").textContent = "$0";
        $("statusText").textContent = "";
        showToast("Reset.", true);
      });

      ["company","email","totalCompanyEEs","fieldEEs","pwFieldEEs","pwPercent","benefits","netFringe","wcPercent"]
        .forEach(id => {
          const el = $(id);
          el.addEventListener("input", () => markError(el,false));
          el.addEventListener("change", () => markError(el,false));
        });

    })();
  </script>
</body>
</html>
